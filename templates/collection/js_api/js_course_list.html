<!DOCTYPE html>
<html>
<head>
    <title>Course List</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
</head>
<body class="p-4">

<h2 class="mb-4">Course List</h2>

<table class="table table-bordered table-striped" style="width: 90%;">
    <thead class="table-dark">
        <tr>
            <th>Title</th>
            <th>Price</th>
            <th>Students Qty</th>
            <th>Reviews Qty</th>
            <th>Category</th>
            <th>Remove</th>
        </tr>
    </thead>
    <tbody id="course-body"></tbody>
</table>


<script>
// ðŸ‘‰ Fetch all courses (GET /api/course/)
fetch("/api/course/")
    .then(response => response.json())
    .then(data => {
        console.log(data);

        const tbody = document.getElementById("course-body");
        tbody.innerHTML = "";

        data.forEach(course => {
            tbody.innerHTML += `
                <tr>
                    <td><a href="/course/${course.id}/">${course.title}</a></td>
                    <td>${course.price}</td>
                    <td>${course.student_qty}</td>
                    <td>${course.reviews_qty}</td>
                    <td>${course.category_name}</td>

                    <td>
                        <button 
                           class="btn btn-danger btn-sm"
                           onclick="deleteCourse(${course.id})">
                           Delete
                        </button>
                    </td>
                </tr>
            `;
        });
    });


// ðŸ‘‡ Django CSRF Token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + "=")) {
                cookieValue = cookie.substring(name.length + 1);
            }
        }
    }
    return cookieValue;
}
const csrftoken = getCookie("csrftoken");


// ðŸ‘‰ Delete Course API (DELETE /api/course/<pk>/)
function deleteCourse(id) {
    if (!confirm("Are you sure you want to delete this?")) return;

    fetch(`/api/course/${id}/`, {
        method: "DELETE",
        headers: {
            "X-CSRFToken": csrftoken
        }
    })
    .then(() => {
        alert("Deleted successfully!");
        location.reload();   // Reload table
    });
}
</script>

</body>
</html>
